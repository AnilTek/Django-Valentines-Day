{% extends "layout.html" %}
{% load static %}

{% block content %}

<div class="gallery-container">
    <div class="gallery-grid" id="gallery">
        {% for photo in photos %}
            <div class="secret-image-cards">
                <img class="secret-card-image" src="{{ photo.image.url }}" alt="Avatar" onclick="openModal('{{ photo.image.url }}')">

            </div>
        {% endfor %}
</div>

<div id="image-modal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="modal-image">
</div>


    <!-- Sayfalama Kontrolleri -->
    <div class="pagination">
        {% if photos.has_previous %}
            <a href="?page=1">‚èÆ ƒ∞lk</a>
            <a href="?page={{ photos.previous_page_number }}">‚¨Ö √ñnceki</a>
        {% endif %}

        <span>Sayfa {{ photos.number }} / {{ photos.paginator.num_pages }}</span>

        {% if photos.has_next %}
            <a href="?page={{ photos.next_page_number }}">Sonraki ‚û°</a>
            <a href="?page={{ photos.paginator.num_pages }}">Son ‚è≠</a>
        {% endif %}
    </div>
</div>

<!-- Y√ºkleme Formu -->
<form id="upload-form" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="upload-container">
        <!-- Dosya Se√ß Butonu -->
        <label for="file-input" class="upload-label">üìÇ Dosya Se√ß</label>
        <input type="file" id="file-input" name="images" multiple required>
    
        <!-- Y√ºkleme Butonu -->
        <button type="submit" class="upload-button">‚¨Ü Y√ºkle</button>
    </div>
    
</form>

{% endblock content %}

{% block javascript %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("‚úÖ Gallery script loaded.");
    
        // ‚úÖ IMAGE UPLOAD FUNCTIONALITY
        document.getElementById("upload-form").addEventListener("submit", function (event) {
            event.preventDefault();  
        
            let formData = new FormData(this);
        
            fetch("{% url 'upload' %}", {
                method: "POST",
                body: formData
            })
            .then(response => {
                let contentType = response.headers.get("content-type");
                if (!contentType || !contentType.includes("application/json")) {
                    return response.text().then(text => { throw new Error("Server returned HTML: " + text); });
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    alert("Hata: " + data.error);
                } else {
                    alert(data.message);  
                    location.reload();  // Yeni y√ºklenen fotoƒüraflarƒ± g√∂rmek i√ßin sayfayƒ± yenile
                }
            })
            .catch(error => {
                console.error("Hata:", error);
                alert("Y√ºkleme sƒ±rasƒ±nda bir hata olu≈ütu! Ayrƒ±ntƒ±lar i√ßin konsolu kontrol et.");
            });
        });
    
        // ‚úÖ Ensure all images open the modal on click
        document.querySelectorAll(".secret-card-image").forEach(image => {
            image.addEventListener("click", function () {
                openModal(this.src);
            });
        });
    
        // ‚úÖ MODAL FUNCTIONS
        function openModal(imageUrl) {
            let modal = document.getElementById("image-modal");
            let modalImage = document.getElementById("modal-image");
    
            if (!modal || !modalImage) {
                console.error("‚ùå Modal or Image Element not found!");
                return;
            }
    
            modal.classList.remove("hidden"); // **Siyah overlay √ßƒ±kmasƒ±nƒ± engellemek i√ßin CSS ile kontrol et**
            modal.style.display = "flex";
            modalImage.src = imageUrl;
        }
    
        function closeModal() {
            let modal = document.getElementById("image-modal");
            if (modal) {
                modal.classList.add("hidden"); // Modal tamamen kapanƒ±r, overlay olu≈ümaz
                modal.style.display = "none";
            }
        }
    
        // ‚úÖ Close modal when clicking outside of the image
        window.onclick = function (event) {
            let modal = document.getElementById("image-modal");
            if (event.target === modal) {
                closeModal();
            }
        };
    
        // ‚úÖ Close button functionality
        document.querySelector(".close").addEventListener("click", closeModal);
    
        // ‚úÖ Fix black overlay when changing pages
        document.querySelectorAll(".pagination a").forEach(button => {
            button.addEventListener("click", function () {
                closeModal(); 
            });
        });
    });
    
    

</script>
{% endblock javascript %}
